<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/J-S-WEB/images/favicon.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #10B981; }
        .error { color: #EF4444; }
        .info { color: #8b2d42; }
        button {
            padding: 10px 20px;
            background: #6a1a2b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4d1320;
        }
        pre {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="/J-S-WEB/js/firebase-config.example.js"></script>
</head>
<body>
    <h1>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>1. Firebase ì´ˆê¸°í™” í™•ì¸</h2>
        <div id="init-check"></div>
        <button onclick="checkInitialization()">ì´ˆê¸°í™” í™•ì¸</button>
    </div>
    
    <div class="test-section">
        <h2>2. Firestore ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <div id="firestore-check"></div>
        <button onclick="testFirestore()">Firestore í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div class="test-section">
        <h2>3. Storage ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <div id="storage-check"></div>
        <button onclick="testStorage()">Storage í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div class="test-section">
        <h2>4. Authentication ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <div id="auth-check"></div>
        <button onclick="testAuth()">Authentication í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div class="test-section">
        <h2>5. ê²¬ì  ë°ì´í„° ì“°ê¸° í…ŒìŠ¤íŠ¸</h2>
        <div id="write-check"></div>
        <button onclick="testWrite()">ë°ì´í„° ì“°ê¸° í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <div class="test-section">
        <h2>6. ê²¬ì  ë°ì´í„° ì½ê¸° í…ŒìŠ¤íŠ¸</h2>
        <div id="read-check"></div>
        <button onclick="testRead()">ë°ì´í„° ì½ê¸° í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <script>
        function logResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            const className = isSuccess ? 'success' : 'error';
            element.innerHTML = `<p class="${className}">${message}</p>`;
        }
        
        function checkInitialization() {
            const result = document.getElementById('init-check');
            try {
                if (typeof firebase === 'undefined') {
                    logResult('init-check', 'âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                    return;
                }
                
                if (typeof db === 'undefined') {
                    logResult('init-check', 'âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                    return;
                }
                
                if (typeof storage === 'undefined') {
                    logResult('init-check', 'âŒ Storageê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                    return;
                }
                
                if (typeof auth === 'undefined') {
                    logResult('init-check', 'âŒ Authenticationì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', false);
                    return;
                }
                
                logResult('init-check', 'âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ', true);
                result.innerHTML += `<pre>í”„ë¡œì íŠ¸ ID: ${firebaseConfig.projectId}</pre>`;
            } catch (error) {
                logResult('init-check', 'âŒ ì˜¤ë¥˜: ' + error.message, false);
            }
        }
        
        async function testFirestore() {
            const result = document.getElementById('firestore-check');
            try {
                logResult('firestore-check', 'â³ Firestore ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', true);
                
                // ê°„ë‹¨í•œ ì½ê¸° í…ŒìŠ¤íŠ¸
                const testDoc = await db.collection('test').limit(1).get();
                logResult('firestore-check', 'âœ… Firestore ì—°ê²° ì„±ê³µ!', true);
                result.innerHTML += `<pre>ì½ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ (${testDoc.size}ê°œ ë¬¸ì„œ)</pre>`;
            } catch (error) {
                logResult('firestore-check', 'âŒ Firestore ì—°ê²° ì‹¤íŒ¨: ' + error.message, false);
                result.innerHTML += `<pre>ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'ì•Œ ìˆ˜ ì—†ìŒ'}</pre>`;
                
                if (error.code === 'permission-denied') {
                    result.innerHTML += `<p class="info">ğŸ’¡ Firestore ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”. Firebase ì½˜ì†”ì—ì„œ Firestore ê·œì¹™ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.</p>`;
                }
            }
        }
        
        async function testStorage() {
            const result = document.getElementById('storage-check');
            try {
                logResult('storage-check', 'â³ Storage ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', true);
                
                // Storage ì°¸ì¡° í…ŒìŠ¤íŠ¸
                const testRef = storage.ref('test/test.txt');
                logResult('storage-check', 'âœ… Storage ì—°ê²° ì„±ê³µ!', true);
                result.innerHTML += `<pre>Storage ì°¸ì¡° ìƒì„± ì™„ë£Œ</pre>`;
            } catch (error) {
                logResult('storage-check', 'âŒ Storage ì—°ê²° ì‹¤íŒ¨: ' + error.message, false);
            }
        }
        
        async function testAuth() {
            const result = document.getElementById('auth-check');
            try {
                logResult('auth-check', 'â³ Authentication í…ŒìŠ¤íŠ¸ ì¤‘...', true);
                
                // í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        logResult('auth-check', 'âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì: ' + user.email, true);
                    } else {
                        logResult('auth-check', 'â„¹ï¸ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ (ì •ìƒ)', true);
                    }
                });
                
                result.innerHTML += `<p class="info">ğŸ’¡ Authentication ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ Firebase ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>`;
            } catch (error) {
                logResult('auth-check', 'âŒ Authentication í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, false);
            }
        }
        
        async function testWrite() {
            const result = document.getElementById('write-check');
            try {
                logResult('write-check', 'â³ ë°ì´í„° ì“°ê¸° í…ŒìŠ¤íŠ¸ ì¤‘...', true);
                
                const testData = {
                    title: 'í…ŒìŠ¤íŠ¸ ê²¬ì  ìš”ì²­',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('quoteRequests_public').doc('test-' + Date.now()).set(testData);
                logResult('write-check', 'âœ… ë°ì´í„° ì“°ê¸° ì„±ê³µ!', true);
                result.innerHTML += `<pre>í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ quoteRequests_public ì»¬ë ‰ì…˜ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</pre>`;
            } catch (error) {
                logResult('write-check', 'âŒ ë°ì´í„° ì“°ê¸° ì‹¤íŒ¨: ' + error.message, false);
                result.innerHTML += `<pre>ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'ì•Œ ìˆ˜ ì—†ìŒ'}</pre>`;
                
                if (error.code === 'permission-denied') {
                    result.innerHTML += `<p class="error">ğŸ’¡ Firestore ë³´ì•ˆ ê·œì¹™ì—ì„œ ì“°ê¸° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>`;
                    result.innerHTML += `<pre>í•„ìš”í•œ ê·œì¹™:
match /quoteRequests_public/{docId} {
  allow write: if true;
}</pre>`;
                }
            }
        }
        
        async function testRead() {
            const result = document.getElementById('read-check');
            try {
                logResult('read-check', 'â³ ë°ì´í„° ì½ê¸° í…ŒìŠ¤íŠ¸ ì¤‘...', true);
                
                const snapshot = await db.collection('quoteRequests_public').limit(5).get();
                logResult('read-check', `âœ… ë°ì´í„° ì½ê¸° ì„±ê³µ! (${snapshot.size}ê°œ ë¬¸ì„œ)`, true);
                
                if (snapshot.empty) {
                    result.innerHTML += `<p class="info">â„¹ï¸ ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê²¬ì  ìš”ì²­ì„ ì œì¶œí•˜ë©´ ë°ì´í„°ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>`;
                } else {
                    let html = '<ul>';
                    snapshot.forEach(doc => {
                        html += `<li>${doc.id}: ${JSON.stringify(doc.data())}</li>`;
                    });
                    html += '</ul>';
                    result.innerHTML += html;
                }
            } catch (error) {
                logResult('read-check', 'âŒ ë°ì´í„° ì½ê¸° ì‹¤íŒ¨: ' + error.message, false);
                result.innerHTML += `<pre>ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'ì•Œ ìˆ˜ ì—†ìŒ'}</pre>`;
                
                if (error.code === 'permission-denied') {
                    result.innerHTML += `<p class="error">ğŸ’¡ Firestore ë³´ì•ˆ ê·œì¹™ì—ì„œ ì½ê¸° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>`;
                } else if (error.code === 'failed-precondition') {
                    result.innerHTML += `<p class="error">ğŸ’¡ ì¸ë±ìŠ¤ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Firebase ì½˜ì†”ì—ì„œ ì¸ë±ìŠ¤ ìƒì„± ë§í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>`;
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì´ˆê¸°í™” í™•ì¸
        window.addEventListener('load', function() {
            setTimeout(checkInitialization, 1000);
        });
    </script>
</body>
</html>


