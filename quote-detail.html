<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="(ì£¼)ì œì´ì•¤ì—ìŠ¤ê±´ì„¤ ê²¬ì  ìƒì„¸">
    <title>ê²¬ì  ìƒì„¸ | (ì£¼)ì œì´ì•¤ì—ìŠ¤ê±´ì„¤</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="/J-S-WEB/js/firebase-config.js"></script>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <img src="images/ì œì´ì—”ì—ìŠ¤ë¡œê³ .jpg" alt="(ì£¼)ì œì´ì•¤ì—ìŠ¤ê±´ì„¤ ë¡œê³ ">
                </div>
                <span>(ì£¼)ì œì´ì•¤ì—ìŠ¤ê±´ì„¤</span>
            </a>
            <nav class="nav-menu">
                <a href="index.html" class="nav-item">ë©”ì¸</a>
                <a href="about.html" class="nav-item">íšŒì‚¬ì†Œê°œ</a>
                <a href="business.html" class="nav-item">ì‚¬ì—…ì˜ì—­</a>
                <a href="portfolio.html" class="nav-item">ì‹œê³µì‹¤ì </a>
                <a href="support.html" class="nav-item">ê³ ê°ì§€ì›</a>
                <a href="quote-list.html" class="nav-item active">ê²¬ì  í˜„í™©</a>
                <div id="auth-buttons" style="display: flex; align-items: center; gap: 0.5rem; margin-left: 1rem;">
                    <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>
            </nav>
            <button class="mobile-menu-btn">â˜°</button>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <section class="section">
            <div class="container">
                <div style="max-width: 900px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <a href="quote-list.html" class="btn btn-outline">â† ëª©ë¡ìœ¼ë¡œ</a>
                        <!-- ê´€ë¦¬ì ì¸ì¦ ìƒíƒœ í‘œì‹œ -->
                        <div id="admin-status" style="display: none;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="color: var(--primary-blue); font-size: 0.875rem;">
                                    <strong>ê´€ë¦¬ì:</strong> <span id="admin-email"></span>
                                </span>
                                <button id="logout-btn" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem;">ë¡œê·¸ì•„ì›ƒ</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="public-content" class="card" style="margin-bottom: 2rem;">
                        <div class="card-body">
                            <div id="loading" style="text-align: center; padding: 3rem;">
                                <div class="spinner" style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #6a1a2b; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                <p style="margin-top: 1rem; color: var(--gray-600);">ë¡œë”© ì¤‘...</p>
                            </div>
                        </div>
                    </div>

                    <div id="private-content"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- í’‹í„° -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>(ì£¼)ì œì´ì•¤ì—ìŠ¤ê±´ì„¤</h3>
                    <p>ì •ë°€í•œ ê¸°ìˆ ê³¼ ì‹ ë¢°ì˜ ì‹œê³µìœ¼ë¡œ<br>ê³ ê°ê³¼ í•¨ê»˜ ì„±ì¥í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="footer-section">
                    <h3>íšŒì‚¬ ì •ë³´</h3>
                    <p>ëŒ€í‘œì: ê¹€ì†Œì—°</p>
                    <p><strong>ë³¸ì‚¬:</strong> ì¸ì²œê´‘ì—­ì‹œ ë¶€í‰êµ¬ ê²½ì¸ë¡œ 1107 2ì¸µ (ì¼ì‹ ë™)</p>
                    <p><strong>ì§€ì‚¬:</strong> ê²½ê¸°ë„ ê¹€í¬ì‹œ ì–‘ì´Œì ì„ëª¨ë¡œ 44ë²ˆê¸¸ 90</p>
                </div>
                <div class="footer-section">
                    <h3>ì—°ë½ì²˜</h3>
                    <p>ì „í™”: <a href="tel:031-986-1190">031-986-1190</a></p>
                    <p>íŒ©ìŠ¤: 031-986-1191</p>
                    <p>ì´ë©”ì¼: <a href="mailto:jandscons@naver.com">jandscons@naver.com</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Copyright Â© 2025 J&S. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="/J-S-WEB/js/script.js"></script>
    <script>
        // URLì—ì„œ ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const quoteId = urlParams.get('id');

        console.log('=== quote-detail.html ë””ë²„ê¹… ì‹œì‘ ===');
        console.log('URL íŒŒë¼ë¯¸í„°:', window.location.search);
        console.log('ì¶”ì¶œëœ ë¬¸ì„œ ID:', quoteId);
        console.log('ë¬¸ì„œ ID íƒ€ì…:', typeof quoteId);
        console.log('ë¬¸ì„œ ID ê¸¸ì´:', quoteId ? quoteId.length : 0);

        if (!quoteId) {
            console.error('ë¬¸ì„œ IDê°€ ì—†ìŠµë‹ˆë‹¤. quote-list.htmlë¡œ ë¦¬ë””ë ‰ì…˜í•©ë‹ˆë‹¤.');
            window.location.href = 'quote-list.html';
        }

        // ê³µê°œ ì½˜í…ì¸ ëŠ” ì¸ì¦ ìƒíƒœì™€ ê´€ê³„ì—†ì´ ë¨¼ì € ë¡œë“œ
        loadPublicContent();

        // ì¸ì¦ ìƒíƒœ UI ì—…ë°ì´íŠ¸
        function updateAuthUI(user) {
            const adminStatus = document.getElementById('admin-status');
            const adminEmail = document.getElementById('admin-email');
            const logoutBtn = document.getElementById('logout-btn');
            const authButtons = document.getElementById('auth-buttons');
            
            if (user) {
                // ë¡œê·¸ì¸ ìƒíƒœ - ê´€ë¦¬ì ëª¨ë“œ
                console.log('ê´€ë¦¬ì ë¡œê·¸ì¸ ìƒíƒœ:', user.email);
                if (adminStatus) adminStatus.style.display = 'block';
                if (adminEmail) adminEmail.textContent = user.email;
                
                // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸
                if (logoutBtn) {
                    logoutBtn.onclick = async function() {
                        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            try {
                                await auth.signOut();
                                console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                                alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                                location.reload();
                            } catch (error) {
                                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                                alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            }
                        }
                    };
                }
                
                // í—¤ë”ì˜ ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¹€ (ê´€ë¦¬ì ëª¨ë“œì¼ ë•ŒëŠ” ë¡œê·¸ì¸ ë²„íŠ¼ ë¶ˆí•„ìš”)
                if (authButtons) {
                    authButtons.innerHTML = '';
                    authButtons.style.display = 'none';
                }
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ - ì¼ë°˜ ì‚¬ìš©ì ëª¨ë“œ
                console.log('ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤. (ì¼ë°˜ ì‚¬ìš©ì ëª¨ë“œ)');
                if (adminStatus) adminStatus.style.display = 'none';
                
                // í—¤ë”ì˜ ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¹€ (ì¼ë°˜ ì‚¬ìš©ìëŠ” í—¤ë”ì— ë¡œê·¸ì¸ ë²„íŠ¼ì´ í•„ìš” ì—†ìŒ)
                // ë¹„ê³µê°œ ì½˜í…ì¸  ì˜ì—­ì˜ "ê´€ë¦¬ì ë¡œê·¸ì¸" ë§í¬ëŠ” showLoginPrompt()ì—ì„œ ìœ ì§€ë¨
                if (authButtons) {
                    authButtons.innerHTML = '';
                    authButtons.style.display = 'none';
                }
            }
        }
        
        // ì¸ì¦ ìƒíƒœ í™•ì¸ ë° ë¹„ê³µê°œ ì½˜í…ì¸  ë¡œë“œ
        auth.onAuthStateChanged(async (user) => {
            // UI ì—…ë°ì´íŠ¸
            updateAuthUI(user);
            
            if (user) {
                // ê´€ë¦¬ì ë¡œê·¸ì¸ ìƒíƒœ
                console.log('ê´€ë¦¬ì ë¡œê·¸ì¸ í™•ì¸. ì¸ì¦ í† í°ì„ ì¤€ë¹„í•©ë‹ˆë‹¤...');
                
                try {
                    // â˜… í•µì‹¬ ìˆ˜ì •: ì¸ì¦ í† í°ì´ ì™„ì „íˆ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    // ì´ë ‡ê²Œ í•˜ë©´ Firestore ë³´ì•ˆ ê·œì¹™ì—ì„œ request.auth != nullì„ ì˜¬ë°”ë¥´ê²Œ ì¸ì‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const token = await user.getIdToken();
                    console.log('ì¸ì¦ í† í° ì¤€ë¹„ ì™„ë£Œ. ë¹„ê³µê°œ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.');
                    
                    // í† í°ì´ ì¤€ë¹„ëœ í›„ì—ë§Œ ë¹„ê³µê°œ ë°ì´í„° ë¡œë“œ
                    await loadPrivateContent();
                } catch (tokenError) {
                    console.error('ì¸ì¦ í† í° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', tokenError);
                    showLoginPrompt();
                }
            } else {
                // ë¹„ë¡œê·¸ì¸ ìƒíƒœ
                console.log('ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.');
                showLoginPrompt();
            }
        });

        async function loadPublicContent() {
            const publicContainer = document.getElementById('public-content');
            const loading = document.getElementById('loading');
            
            try {
                console.log('--- Public ë°ì´í„° ì¡°íšŒ ì‹œì‘ ---');
                console.log('ì¡°íšŒí•  ë¬¸ì„œ ID:', quoteId);
                console.log('ì»¬ë ‰ì…˜: quoteRequests_public');
                
                // Firestore ì´ˆê¸°í™” í™•ì¸
                if (typeof db === 'undefined') {
                    throw new Error('Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                const docRef = db.collection('quoteRequests_public').doc(quoteId);
                console.log('ë¬¸ì„œ ì°¸ì¡° ìƒì„± ì™„ë£Œ:', docRef.path);
                
                const doc = await docRef.get();
                console.log('ë¬¸ì„œ ì¡°íšŒ ì™„ë£Œ');
                console.log('ë¬¸ì„œ ì¡´ì¬ ì—¬ë¶€ (doc.exists):', doc.exists);
                console.log('ë¬¸ì„œ ID (doc.id):', doc.id);
                
                if (!doc.exists) {
                    console.warn('âš ï¸ Public ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!');
                    console.warn('ì¡°íšŒí•œ ID:', quoteId);
                    console.warn('ì‹¤ì œ Firestoreì— ì´ IDì˜ ë¬¸ì„œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                    
                    // ì „ì²´ ì»¬ë ‰ì…˜ ì¡°íšŒí•˜ì—¬ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ID í™•ì¸
                    try {
                        const allDocs = await db.collection('quoteRequests_public').limit(10).get();
                        console.log('ì „ì²´ Public ë¬¸ì„œ ê°œìˆ˜:', allDocs.size);
                        const existingIds = [];
                        allDocs.forEach(d => {
                            existingIds.push(d.id);
                            console.log('ì¡´ì¬í•˜ëŠ” ë¬¸ì„œ ID:', d.id, 'ì œëª©:', d.data().title);
                        });
                        console.log('ì¡´ì¬í•˜ëŠ” ë¬¸ì„œ ID ëª©ë¡:', existingIds);
                    } catch (listError) {
                        console.error('ì „ì²´ ë¬¸ì„œ ì¡°íšŒ ì‹¤íŒ¨:', listError);
                    }
                    
                    publicContainer.innerHTML = `
                        <div class="card-body">
                            <p style="color: #EF4444;">ê²¬ì  ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="color: var(--gray-600); margin-top: 0.5rem; font-size: 0.875rem;">ë¬¸ì„œ ID: ${quoteId}</p>
                            <p style="color: var(--gray-500); margin-top: 0.5rem; font-size: 0.75rem;">ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                            <a href="quote-list.html" class="btn btn-primary" style="margin-top: 1rem;">ëª©ë¡ìœ¼ë¡œ</a>
                        </div>
                    `;
                    return;
                }

                const data = doc.data();
                const date = data.createdAt ? data.createdAt.toDate().toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'ë‚ ì§œ ì—†ìŒ';

                loading.style.display = 'none';
                publicContainer.innerHTML = `
                    <div class="card-body">
                        <h2 style="color: var(--primary-blue); margin-bottom: 1rem;">${data.title || 'ì œëª© ì—†ìŒ'}</h2>
                        <p style="color: var(--gray-600);">ì ‘ìˆ˜ì¼: ${date}</p>
                    </div>
                `;

            } catch (error) {
                console.error('ê³µê°œ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                loading.style.display = 'none';
                publicContainer.innerHTML = `
                    <div class="card-body">
                        <p style="color: #EF4444;">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                        <p style="color: var(--gray-600); margin-top: 0.5rem; font-size: 0.875rem;">${error.message}</p>
                    </div>
                `;
            }
        }

        async function loadPrivateContent() {
            const privateContainer = document.getElementById('private-content');
            
            // ë¡œë”© í‘œì‹œ
            privateContainer.innerHTML = `
                <div class="card">
                    <div class="card-body" style="text-align: center; padding: 2rem;">
                        <div class="spinner" style="display: inline-block; width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #6a1a2b; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p style="margin-top: 1rem; color: var(--gray-600);">ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            `;
            
            try {
                console.log('--- Private ë°ì´í„° ì¡°íšŒ ì‹œì‘ ---');
                console.log('ì¡°íšŒí•  ë¬¸ì„œ ID:', quoteId);
                console.log('ì»¬ë ‰ì…˜: quoteRequests_private');
                
                // ì¸ì¦ ìƒíƒœ ì¬í™•ì¸ (ì•ˆì „ì¥ì¹˜)
                const currentUser = auth.currentUser;
                if (!currentUser) {
                    throw new Error('ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                }
                console.log('ì¸ì¦ëœ ì‚¬ìš©ì:', currentUser.email);

                // ì¸ì¦ í† í° ì¬í™•ì¸ (ì¶”ê°€ ì•ˆì „ì¥ì¹˜)
                try {
                    const token = await currentUser.getIdToken(true); // true = ê°•ì œ ìƒˆë¡œê³ ì¹¨
                    console.log('ì¸ì¦ í† í° í™•ì¸ ì™„ë£Œ');
                } catch (tokenError) {
                    console.error('ì¸ì¦ í† í° ì¬í™•ì¸ ì‹¤íŒ¨:', tokenError);
                    throw new Error('ì¸ì¦ í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                }

                // Firestore ì¿¼ë¦¬ ì‹¤í–‰
                const docRef = db.collection('quoteRequests_private').doc(quoteId);
                console.log('Private ë¬¸ì„œ ì°¸ì¡° ìƒì„± ì™„ë£Œ:', docRef.path);
                
                const doc = await docRef.get();
                console.log('Private ë¬¸ì„œ ì¡°íšŒ ì™„ë£Œ');
                console.log('ë¬¸ì„œ ì¡´ì¬ ì—¬ë¶€ (doc.exists):', doc.exists);
                console.log('ë¬¸ì„œ ID (doc.id):', doc.id);
                
                // â˜… í•µì‹¬ ìˆ˜ì •: doc.existsê°€ falseì¸ ê²½ìš°ì™€ permission-denied ì˜¤ë¥˜ë¥¼ êµ¬ë¶„
                // doc.existsê°€ falseì´ë©´ ë¬¸ì„œê°€ ì •ë§ë¡œ ì—†ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.
                if (!doc.exists) {
                    console.warn('âš ï¸ Private ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!');
                    console.warn('ì¡°íšŒí•œ ID:', quoteId);
                    console.warn('Public ë¬¸ì„œëŠ” ì¡´ì¬í•˜ì§€ë§Œ Private ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
                    console.warn('ì´ëŠ” ë°ì´í„° ì €ì¥ ì‹œ ë¬¸ì œê°€ ìˆì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    
                    // ì „ì²´ Private ì»¬ë ‰ì…˜ ì¡°íšŒí•˜ì—¬ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ID í™•ì¸
                    try {
                        const allPrivateDocs = await db.collection('quoteRequests_private').limit(10).get();
                        console.log('ì „ì²´ Private ë¬¸ì„œ ê°œìˆ˜:', allPrivateDocs.size);
                        const existingPrivateIds = [];
                        allPrivateDocs.forEach(d => {
                            existingPrivateIds.push(d.id);
                            console.log('ì¡´ì¬í•˜ëŠ” Private ë¬¸ì„œ ID:', d.id);
                        });
                        console.log('ì¡´ì¬í•˜ëŠ” Private ë¬¸ì„œ ID ëª©ë¡:', existingPrivateIds);
                        
                        // Publicê³¼ Private ID ë¹„êµ
                        const allPublicDocs = await db.collection('quoteRequests_public').limit(10).get();
                        const existingPublicIds = [];
                        allPublicDocs.forEach(d => {
                            existingPublicIds.push(d.id);
                        });
                        console.log('Public ë¬¸ì„œ ID ëª©ë¡:', existingPublicIds);
                        console.log('Private ë¬¸ì„œ ID ëª©ë¡:', existingPrivateIds);
                        
                        // ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ID ì°¾ê¸°
                        const missingInPrivate = existingPublicIds.filter(id => !existingPrivateIds.includes(id));
                        const missingInPublic = existingPrivateIds.filter(id => !existingPublicIds.includes(id));
                        if (missingInPrivate.length > 0) {
                            console.warn('âš ï¸ Publicì—ëŠ” ìˆì§€ë§Œ Privateì—ëŠ” ì—†ëŠ” ID:', missingInPrivate);
                        }
                        if (missingInPublic.length > 0) {
                            console.warn('âš ï¸ Privateì—ëŠ” ìˆì§€ë§Œ Publicì—ëŠ” ì—†ëŠ” ID:', missingInPublic);
                        }
                    } catch (listError) {
                        console.error('ì „ì²´ ë¬¸ì„œ ì¡°íšŒ ì‹¤íŒ¨:', listError);
                        console.error('ì˜¤ë¥˜ ì½”ë“œ:', listError.code);
                        console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', listError.message);
                    }
                    
                    privateContainer.innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <p style="color: var(--gray-600);">ìƒì„¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë¬¸ì„œ ì—†ìŒ)</p>
                                <p style="color: var(--gray-500); font-size: 0.875rem; margin-top: 0.5rem;">ë¬¸ì„œ ID: ${quoteId}</p>
                                <p style="color: var(--gray-500); font-size: 0.875rem; margin-top: 0.5rem;">ì´ ë¬¸ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                                <p style="color: var(--gray-400); font-size: 0.75rem; margin-top: 0.5rem;">ğŸ’¡ ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ë””ë²„ê¹… ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const data = doc.data();
                let fileLinks = '';
                
                if (data.fileUrls && data.fileUrls.length > 0) {
                    fileLinks = '<div style="margin-top: 1.5rem;"><h4 style="color: var(--gray-800); margin-bottom: 0.5rem;">ì²¨ë¶€íŒŒì¼</h4><ul style="list-style: none; padding-left: 0;">';
                    data.fileUrls.forEach((url, index) => {
                        const fileName = url.split('/').pop().split('?')[0];
                        fileLinks += `<li style="margin-bottom: 0.5rem;"><a href="${url}" target="_blank" style="color: var(--primary-blue); text-decoration: none;">ğŸ“ ${fileName}</a></li>`;
                    });
                    fileLinks += '</ul></div>';
                }

                privateContainer.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; border-bottom: 2px solid var(--gray-200); padding-bottom: 0.5rem;">ìƒì„¸ ì •ë³´ (ê´€ë¦¬ì ì „ìš©)</h3>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <strong style="color: var(--gray-700);">ì„±í•¨/íšŒì‚¬ëª…:</strong>
                                    <p style="margin-top: 0.25rem; color: var(--gray-800);">${data.name || '-'}</p>
                                </div>
                                <div>
                                    <strong style="color: var(--gray-700);">ì—°ë½ì²˜:</strong>
                                    <p style="margin-top: 0.25rem; color: var(--gray-800);">${data.contact || '-'}</p>
                                </div>
                                <div>
                                    <strong style="color: var(--gray-700);">ì´ë©”ì¼:</strong>
                                    <p style="margin-top: 0.25rem; color: var(--gray-800);">${data.email || '-'}</p>
                                </div>
                                <div>
                                    <strong style="color: var(--gray-700);">ì‹œê³µ ë¶„ì•¼:</strong>
                                    <p style="margin-top: 0.25rem; color: var(--gray-800);">${data.businessArea || 'ê¸°íƒ€'}</p>
                                </div>
                                ${data.location ? `
                                <div>
                                    <strong style="color: var(--gray-700);">ì‹œê³µ ì¥ì†Œ:</strong>
                                    <p style="margin-top: 0.25rem; color: var(--gray-800);">${data.location}</p>
                                </div>
                                ` : ''}
                                <div>
                                    <strong style="color: var(--gray-700);">ë¬¸ì˜ ë‚´ìš©:</strong>
                                    <div style="margin-top: 0.5rem; padding: 1rem; background: var(--gray-100); border-radius: 8px; color: var(--gray-800); white-space: pre-wrap;">${data.details || '-'}</div>
                                </div>
                                ${fileLinks}
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ë¹„ê³µê°œ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ì½”ë“œ:', error.code);
                console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                
                let errorMessage = 'ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                let errorDetail = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                let showRetryButton = false;
                let isPermissionError = false;
                
                // â˜… í•µì‹¬ ìˆ˜ì •: permission-denied ì˜¤ë¥˜ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬
                // permission-deniedëŠ” ë¬¸ì„œê°€ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼ ê¶Œí•œ ë¬¸ì œì…ë‹ˆë‹¤.
                if (error.code === 'permission-denied') {
                    isPermissionError = true;
                    errorMessage = 'ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. (permission-denied)';
                    errorDetail = 'ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. ì¸ì¦ í† í°ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                    showRetryButton = true;
                    
                    console.warn('âš ï¸ ê¶Œí•œ ì˜¤ë¥˜: ë¬¸ì„œê°€ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼ ê¶Œí•œ ë¬¸ì œì…ë‹ˆë‹¤.');
                    console.warn('ì¸ì¦ ìƒíƒœ:', auth.currentUser ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒë¨');
                    
                    // ì¬ì‹œë„ ë¡œì§: ì¸ì¦ í† í°ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„
                    console.log('ê¶Œí•œ ì˜¤ë¥˜ ë°œìƒ. ì¸ì¦ í† í°ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ì¬ì‹œë„í•©ë‹ˆë‹¤...');
                    
                    // ì ì‹œ í›„ ìë™ ì¬ì‹œë„ (ì„ íƒì‚¬í•­)
                    setTimeout(async () => {
                        const currentUser = auth.currentUser;
                        if (currentUser) {
                            try {
                                await currentUser.getIdToken(true); // ê°•ì œ ìƒˆë¡œê³ ì¹¨
                                console.log('ì¸ì¦ í† í° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ. ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¡œë“œí•©ë‹ˆë‹¤.');
                                await loadPrivateContent(); // ì¬ì‹œë„
                            } catch (retryError) {
                                console.error('ì¬ì‹œë„ ì‹¤íŒ¨:', retryError);
                            }
                        }
                    }, 1000);
                    
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Firebase ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    errorDetail = 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.';
                    showRetryButton = true;
                } else if (error.message && error.message.includes('ì¸ì¦')) {
                    errorMessage = 'ì¸ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    errorDetail = error.message;
                    showRetryButton = true;
                }
                
                privateContainer.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <p style="color: #EF4444; font-weight: bold;">${errorMessage}</p>
                            <p style="color: var(--gray-600); margin-top: 0.5rem; font-size: 0.875rem;">${errorDetail}</p>
                            <p style="color: var(--gray-500); font-size: 0.75rem; margin-top: 0.5rem;">ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'N/A'}</p>
                            ${isPermissionError ? `
                            <p style="color: var(--primary-blue); font-size: 0.75rem; margin-top: 0.5rem;">
                                ğŸ’¡ ì°¸ê³ : ì´ ì˜¤ë¥˜ëŠ” ë¬¸ì„œê°€ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼ ê¶Œí•œ ë¬¸ì œì…ë‹ˆë‹¤. 
                                ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
                            </p>
                            ` : ''}
                            ${showRetryButton ? `
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <a href="admin.html?redirect=quote-detail.html?id=${encodeURIComponent(quoteId)}" class="btn btn-primary">ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ê¸°</a>
                                <button onclick="location.reload()" class="btn btn-outline">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                            ` : ''}
                            <p style="color: var(--gray-400); font-size: 0.75rem; margin-top: 1rem;">
                                ğŸ’¡ ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ë””ë²„ê¹… ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        function showLoginPrompt() {
            const privateContainer = document.getElementById('private-content');
            privateContainer.innerHTML = `
                <div class="card">
                    <div class="card-body" style="text-align: center; padding: 3rem;">
                        <p style="color: var(--gray-600); font-size: 1.125rem; margin-bottom: 1.5rem;">
                            ìƒì„¸ ë‚´ìš©ì€ ê´€ë¦¬ìë§Œ ì—´ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <a href="admin.html?redirect=quote-detail.html?id=${quoteId}" class="btn btn-primary">ê´€ë¦¬ì ë¡œê·¸ì¸</a>
                    </div>
                </div>
            `;
        }
    </script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>


